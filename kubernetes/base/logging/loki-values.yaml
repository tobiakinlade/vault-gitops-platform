loki:
  auth_enabled: false
  
  commonConfig:
    replication_factor: 1
  
  # Schema configuration (REQUIRED)
  schemaConfig:
    configs:
      - from: 2024-01-01
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: index_
          period: 24h
  
  storage:
    type: filesystem
  
  limits_config:
    retention_period: 744h  # 31 days
    max_query_length: 721h  # 30 days
  
  resources:
    requests:
      cpu: 200m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

# Single Binary deployment mode
deploymentMode: SingleBinary

singleBinary:
  replicas: 1
  
  persistence:
    enabled: true
    storageClass: gp3
    size: 30Gi
  
  resources:
    requests:
      cpu: 500m
      memory: 512Mi
    limits:
      cpu: 1000m
      memory: 2Gi

# Promtail configuration
promtail:
  enabled: true
  
  config:
    clients:
      - url: http://{{ .Release.Name }}-gateway/loki/api/v1/push
    
    positions:
      filename: /tmp/positions.yaml
    
    scrape_configs:
      # Scrape all pods
      - job_name: kubernetes-pods
        kubernetes_sd_configs:
          - role: pod
        
        pipeline_stages:
          - cri: {}
        
        relabel_configs:
          # Add node name
          - source_labels: [__meta_kubernetes_pod_node_name]
            target_label: node_name
          
          # Add namespace
          - source_labels: [__meta_kubernetes_namespace]
            target_label: namespace
          
          # Add pod name
          - source_labels: [__meta_kubernetes_pod_name]
            target_label: pod
          
          # Add container name
          - source_labels: [__meta_kubernetes_pod_container_name]
            target_label: container
          
          # Add app label
          - source_labels: [__meta_kubernetes_pod_label_app]
            target_label: app
          
          # Add component label
          - source_labels: [__meta_kubernetes_pod_label_component]
            target_label: component
          
          # Drop kube-system namespace (too noisy)
          - source_labels: [__meta_kubernetes_namespace]
            action: drop
            regex: kube-system
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Gateway configuration
gateway:
  enabled: true
  replicas: 1
  
  service:
    type: ClusterIP
    port: 80
  
  resources:
    requests:
      cpu: 100m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

# Disable enterprise features
enterprise:
  enabled: false

# Monitoring
monitoring:
  selfMonitoring:
    enabled: false
    grafanaAgent:
      installOperator: false

# Disable unnecessary components for SingleBinary mode
backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0

# Testing
test:
  enabled: false
